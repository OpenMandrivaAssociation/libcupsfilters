From 9fac66e759a037ea7cbca8e6684b96ed8306b6a0 Mon Sep 17 00:00:00 2001
From: ishpreet404 <145900339+ishpreet404@users.noreply.github.com>
Date: Thu, 30 Oct 2025 16:59:47 +0530
Subject: [PATCH 20/33] cfFilterImageToPDF(): Added extra debug log messages
 concerning page orientation (#102)

---
 cupsfilters/imagetopdf.c | 20 ++++++++++++++++++++
 1 file changed, 20 insertions(+)

diff --git a/cupsfilters/imagetopdf.c b/cupsfilters/imagetopdf.c
index 20307463..8ce51dd3 100644
--- a/cupsfilters/imagetopdf.c
+++ b/cupsfilters/imagetopdf.c
@@ -961,9 +961,16 @@ cfFilterImageToPDF(int inputfd,         // I - File descriptor input stream
       normal_landscape = 4;
     if ((val = cupsGetOption("orientation-requested",
 			     num_options, options)) != NULL)
+    {
       tempOrientation = atoi(val);
+      if (log) log(ld, CF_LOGLEVEL_DEBUG,
+		   "cfFilterImageToPDF: orientation-requested=%d received",
+		   tempOrientation);
+    }
     else if ((val = cupsGetOption("landscape", num_options, options)) != NULL)
     {
+      if (log) log(ld, CF_LOGLEVEL_DEBUG,
+		   "cfFilterImageToPDF: landscape=%s received", val);
       if (!strcasecmp(val, "true") || !strcasecmp(val, "yes") ||
 	  !strcasecmp(val, "on") || !strcasecmp(val, "1"))
 	tempOrientation = normal_landscape;
@@ -971,22 +978,35 @@ cfFilterImageToPDF(int inputfd,         // I - File descriptor input stream
 	       !strcasecmp(val, "off") || !strcasecmp(val, "0"))
 	tempOrientation = 3;
     }
+    else
+    {
+      if (log) log(ld, CF_LOGLEVEL_DEBUG,
+		   "cfFilterImageToPDF: No orientation or landscape option provided");
+    }
     if (tempOrientation == 0)
     {
       if (((pw > ph) && (w < h)) || ((pw < ph) && (w > h)))
 	tempOrientation = normal_landscape;
       else
 	tempOrientation = 3;
+      if (log) log(ld, CF_LOGLEVEL_DEBUG,
+		   "cfFilterImageToPDF: Auto-detected tempOrientation=%d",
+		   tempOrientation);
     }
     if (tempOrientation == 4 || tempOrientation == 5)
     {
       int tmp = pw;
       pw = ph;
       ph = tmp;
+      if (log) log(ld, CF_LOGLEVEL_DEBUG,
+		   "cfFilterImageToPDF: Landscape requested, swapping page dimensions");
     }
     doc.Orientation = (tempOrientation == 5 ? 3 :
 		       (tempOrientation == 6 ? 2 :
 			tempOrientation - 3));
+    if (log) log(ld, CF_LOGLEVEL_DEBUG,
+		 "cfFilterImageToPDF: Final doc.Orientation=%d (0=portrait, 1=90deg, 2=180deg, 3=270deg)",
+		 doc.Orientation);
 
     if (w * 72.0 / doc.img->xppi > pw || h * 72.0 / doc.img->yppi > ph)
       document_large = 1;
-- 
2.53.0

